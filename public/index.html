<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gaslighting & AI T√¢m s·ª±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    .title { color: #b91c1c; font-weight: 800; font-size: 2.25rem; opacity: 0; animation: fadeInUp 1s ease forwards 0.2s; }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); }}
    .card-shadow { box-shadow: 0 8px 20px rgba(2,6,23,0.08); transition: transform 0.2s; }
    .card-shadow:hover { transform: translateY(-2px); }
    /* Chat bubbles */
    .chat-container { height: 400px; overflow-y: auto; scroll-behavior: smooth; }
    .user-msg { background-color: #dbeafe; color: #1e40af; border-radius: 18px 18px 4px 18px; margin-left: auto; max-width: 80%; }
    .ai-msg { background-color: #f3f4f6; color: #1f2937; border-radius: 18px 18px 18px 4px; margin-right: auto; max-width: 90%; }
    /* Loading dots */
    .typing-indicator span { display: inline-block; width: 6px; height: 6px; background-color: #9ca3af; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; margin: 0 1px; }
    .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
  
  <div class="max-w-5xl mx-auto p-4 md:p-6">
    <header class="mb-10 text-center">
      <h1 class="title">Thao t√∫ng t√¢m l√Ω (Gaslighting)</h1>
      <p class="mt-2 text-gray-600">Nh·∫≠n di·ªán, ph√≤ng tr√°nh v√† t√¢m s·ª± c√πng AI.</p>
    </header>

    <main class="space-y-10">
      
      <div class="w-full flex justify-center shadow-lg rounded-xl overflow-hidden">
        <img src="https://images.unsplash.com/photo-1573497620053-ea5300f94f21?w=1200&q=80&auto=format&fit=crop" alt="Gaslighting Banner" class="w-full object-cover h-48 md:h-80" />
      </div>

      <section id="dinh-nghia" class="bg-[#fff7ed] p-6 md:p-8 rounded-2xl card-shadow border border-orange-100">
        <h2 class="text-2xl font-bold mb-6 text-orange-800 border-b pb-2 border-orange-200">ƒê·ªãnh nghƒ©a</h2>
        <div class="grid md:grid-cols-2 gap-8 items-start">
            <div class="space-y-4">
                <h3 class="font-bold text-lg text-red-600">Gaslighting l√† g√¨?</h3>
                <p class="text-sm">L√† h√†nh vi thao t√∫ng khi·∫øn b·∫°n nghi ng·ªù ch√≠nh k√Ω ·ª©c v√† c·∫£m nh·∫≠n c·ªßa m√¨nh.</p>
            </div>
            <div class="space-y-4">
                <h3 class="font-bold text-lg text-blue-600">Self-gaslighting l√† g√¨?</h3>
                <p class="text-sm">L√† khi b·∫°n t·ª± nghi ng·ªù b·∫£n th√¢n v√† bi·ªán minh cho k·∫ª thao t√∫ng.</p>
            </div>
        </div>
      </section>

      <section class="bg-white p-6 rounded-2xl card-shadow">
          <h2 class="text-xl font-bold mb-4">Bi·ªÉu hi·ªán</h2>
          <ul class="list-disc pl-5 space-y-2 text-gray-700">
              <li>Ph·ªß nh·∫≠n th·ª±c t·∫ø ("Tao ch∆∞a bao gi·ªù n√≥i th·∫ø").</li>
              <li>B√≥p m√©o s·ª± th·∫≠t, ƒë·ªï l·ªói ng∆∞·ª£c l·∫°i cho b·∫°n.</li>
              <li>C√¥ l·∫≠p b·∫°n kh·ªèi nh·ªØng ng∆∞·ªùi kh√°c.</li>
          </ul>
      </section>

      <section id="ai-consultant" class="bg-white p-1 rounded-2xl card-shadow overflow-hidden border-2 border-green-100">
        <div class="bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white rounded-t-xl">
          <h2 class="text-2xl font-bold flex items-center gap-2">
            üå± T√¢m s·ª± c√πng Gaslighting
          </h2>
          <p class="text-green-100 text-sm mt-1">AI ƒë√≥ng vai ng∆∞·ªùi b·∫°n l·∫Øng nghe, b·∫£o m·∫≠t v√† ·∫©n danh ho√†n to√†n.</p>
        </div>

        <div class="p-6">
          <div id="chatHistory" class="chat-container bg-gray-50 border border-gray-200 rounded-xl p-4 mb-4 space-y-4">
            <div class="ai-msg p-3 text-sm shadow-sm">
              Ch√†o b·∫°n! M√¨nh l√† "T√¢m s·ª± Gaslighting". M√¨nh ·ªü ƒë√¢y ƒë·ªÉ l·∫Øng nghe m·ªçi chuy·ªán b·∫°n ƒëang g·∫∑p ph·∫£i. B·∫°n c·ª© k·ªÉ ƒëi, m√¨nh s·∫Ω b·∫£o v·ªá b·∫°n. üõ°Ô∏è
            </div>
          </div>

          <div class="relative">
            <textarea id="userPrompt" rows="3" class="w-full p-4 pr-24 bg-gray-100 rounded-xl border-transparent focus:bg-white focus:ring-2 focus:ring-green-500 outline-none resize-none" placeholder="Nh·∫≠p c√¢u chuy·ªán c·ªßa b·∫°n..."></textarea>
            <button id="sendMessageBtn" class="absolute bottom-3 right-3 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition disabled:opacity-50 disabled:cursor-not-allowed">
              G·ª≠i tin
            </button>
          </div>
        </div>
      </section>

      <section id="tam-su" class="bg-white p-6 rounded-2xl card-shadow border-t-4 border-blue-500">
        <h2 class="text-xl font-bold mb-3">G·ª≠i th∆∞ chia s·∫ª</h2>
        <p class="text-sm text-gray-600 mb-6">N·∫øu b·∫°n mu·ªën g·ª≠i th∆∞ d√†i, h√£y d√πng form b√™n d∆∞·ªõi.</p>
        <div class="grid md:grid-cols-2 gap-8">
          <div>
            <label class="block text-sm font-medium text-gray-700">T√™n c·ªßa b·∫°n</label>
            <input id="emailName" class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm p-2" placeholder="Ng∆∞·ªùi ·∫©n danh" />
            <label class="block text-sm font-medium mt-4 text-gray-700">N·ªôi dung</label>
            <textarea id="emailMessage" rows="5" class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm p-2" placeholder="Vi·∫øt th∆∞..."></textarea>
            <button id="sendEmailBtn" class="mt-4 px-6 py-2 rounded-lg bg-blue-600 text-white shadow-md">G·ª≠i th∆∞ (M·ªü Mail)</button>
          </div>
        </div>
      </section>

      <footer class="text-center text-xs text-gray-400 py-8 border-t mt-8">
        &copy; 2025 D·ª± √°n Nh·∫≠n Di·ªán Gaslighting.
      </footer>
    </main>
  </div>

  <script>
    /* --- LOGIC CHAT V·ªöI VERCEL SERVER --- */
    const chatHistoryDiv = document.getElementById('chatHistory');
    const userPromptInput = document.getElementById('userPrompt');
    const sendBtn = document.getElementById('sendMessageBtn');

    // L∆∞u tr·ªØ l·ªãch s·ª≠ t·∫°i Client ƒë·ªÉ g·ª≠i l√™n Server (V√¨ serverless kh√¥ng nh·ªõ)
    let conversationHistory = [
      {
        role: "user",
        parts: [{ text: "B·∫°n l√† m·ªôt chuy√™n gia t√¢m l√Ω th√¢n thi·ªán. H√£y l·∫Øng nghe c√¢u chuy·ªán v·ªÅ t√¨nh b·∫°n, x√°c ƒë·ªãnh xem c√≥ Gaslighting kh√¥ng v√† ƒë∆∞a ra l·ªùi khuy√™n ng·∫Øn g·ªçn, c·∫£m x√∫c. D√πng emoji." }]
      },
      {
        role: "model",
        parts: [{ text: "Ch√†o b·∫°n, m√¨nh l√† T√¢m s·ª± Gaslighting. M√¨nh ·ªü ƒë√¢y ƒë·ªÉ l·∫Øng nghe b·∫°n. üõ°Ô∏è" }]
      }
    ];

    function appendMessage(role, text) {
      const div = document.createElement('div');
      div.className = role === 'user' ? 'user-msg p-3 text-sm shadow-sm mb-3' : 'ai-msg p-3 text-sm shadow-sm mb-3';
      div.innerHTML = role === 'model' ? marked.parse(text) : text.replace(/\n/g, '<br>');
      chatHistoryDiv.appendChild(div);
      chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
    }

    function showLoading() {
      const div = document.createElement('div');
      div.id = 'loadingIndicator';
      div.className = 'ai-msg p-3 text-sm shadow-sm mb-3 typing-indicator';
      div.innerHTML = '<span></span><span></span><span></span>';
      chatHistoryDiv.appendChild(div);
      chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
    }

    function removeLoading() {
      const loading = document.getElementById('loadingIndicator');
      if(loading) loading.remove();
    }

    sendBtn.addEventListener('click', async () => {
      const userText = userPromptInput.value.trim();
      if (!userText) return;

      appendMessage('user', userText);
      userPromptInput.value = '';
      showLoading();

      try {
        // G·ªçi ƒë·∫øn API c·ªßa ch√≠nh trang web n√†y (ƒë∆∞·ª£c host tr√™n Vercel)
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            history: conversationHistory, // G·ª≠i k√®m l·ªãch s·ª≠ c≈©
            message: userText // G·ª≠i tin nh·∫Øn m·ªõi
          })
        });

        const data = await response.json();
        removeLoading();

        if (data.error) {
          appendMessage('model', `‚ö†Ô∏è L·ªói: ${data.error}`);
        } else {
          appendMessage('model', data.reply);
          // C·∫≠p nh·∫≠t l·ªãch s·ª≠ client
          conversationHistory.push({ role: "user", parts: [{ text: userText }] });
          conversationHistory.push({ role: "model", parts: [{ text: data.reply }] });
        }
      } catch (error) {
        removeLoading();
        appendMessage('model', "‚ö†Ô∏è Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi Server.");
      }
    });

    /* --- LOGIC EMAIL C≈® --- */
    document.getElementById('sendEmailBtn').addEventListener('click', () => {
        const name = document.getElementById('emailName').value || '·∫®n danh';
        const msg = document.getElementById('emailMessage').value;
        window.location.href = `mailto:admin@example.com?subject=T√¢m s·ª± t·ª´ ${name}&body=${msg}`;
    });
  </script>
</body>
</html>
