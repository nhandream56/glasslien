<!doctype html>
<html lang="vi" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nh·∫≠n di·ªán & V∆∞·ª£t qua Gaslighting</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    /* Font & Chung */
    body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
    
    /* Animation */
    .fade-in-up { opacity: 0; transform: translateY(20px); animation: fadeInUp 0.8s ease-out forwards; }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); }}
    .delay-200 { animation-delay: 0.2s; }
    .delay-400 { animation-delay: 0.4s; }

    /* Card & Shadow */
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }

    /* Chat UI */
    .chat-container { height: 500px; overflow-y: auto; scroll-behavior: smooth; }
    .user-msg { background-color: #dbeafe; color: #1e40af; border-radius: 18px 18px 4px 18px; margin-left: auto; max-width: 85%; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .ai-msg { background-color: #f3f4f6; color: #1f2937; border-radius: 18px 18px 18px 4px; margin-right: auto; max-width: 90%; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .error-msg { background-color: #fee2e2; color: #991b1b; border: 1px solid #f87171; border-radius: 12px; padding: 12px; margin-bottom: 16px; font-size: 0.9rem; display: flex; align-items: center; }
    .error-msg::before { content: '‚ö†Ô∏è'; margin-right: 8px; font-size: 1.2em; }

    /* Typing Indicator */
    .typing-indicator span { display: inline-block; width: 8px; height: 8px; background-color: #9ca3af; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; margin: 0 2px; }
    .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 leading-relaxed">
  
  <header class="relative w-full h-64 md:h-96 overflow-hidden bg-slate-900 flex items-center justify-center">
    <img src="/images/image_1.jpg" alt="Tay ƒëi·ªÅu khi·ªÉn n√£o v√† tim" class="absolute inset-0 w-full h-full object-cover opacity-60">
    <div class="relative z-10 text-center p-4 fade-in-up">
      <h1 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight mb-2 text-shadow-lg">
        Thao T√∫ng T√¢m L√Ω <br class="md:hidden">(Gaslighting)
      </h1>
      <p class="text-lg md:text-xl text-slate-200 font-medium">Nh·∫≠n di·ªán b√≥ng t·ªëi, t√¨m l·∫°i √°nh s√°ng cho ch√≠nh m√¨nh.</p>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-4 md:p-8 space-y-16 -mt-10 relative z-20">

    <section class="bg-white p-6 md:p-8 rounded-3xl shadow-xl card-hover fade-in-up delay-200">
      <div class="grid md:grid-cols-2 gap-8 items-center">
        <div>
          <h2 class="text-3xl font-bold text-slate-900 mb-6 flex items-center">
            <span class="bg-indigo-600 w-2 h-8 mr-3 rounded-full"></span>
            ƒê·ªãnh nghƒ©a
          </h2>
          <div class="space-y-6">
            <div class="bg-red-50 p-5 rounded-xl border-l-4 border-red-500">
              <h3 class="text-xl font-bold text-red-700 mb-2">Gaslighting (Thao t√∫ng t·ª´ b√™n ngo√†i)</h3>
              <p class="text-slate-700">H√†nh vi c·ªë t√¨nh l√†m ng∆∞·ªùi kh√°c nghi ng·ªù nh·∫≠n th·ª©c, tr√≠ nh·ªõ v√† s·ª± t·ªânh t√°o c·ªßa ch√≠nh h·ªç nh·∫±m m·ª•c ƒë√≠ch ki·ªÉm so√°t v√† chi ph·ªëi.</p>
            </div>
            <div class="bg-blue-50 p-5 rounded-xl border-l-4 border-blue-500">
              <h3 class="text-xl font-bold text-blue-700 mb-2">Self-Gaslighting (T·ª± thao t√∫ng)</h3>
              <p class="text-slate-700">H·∫≠u qu·∫£ c·ªßa vi·ªác b·ªã thao t√∫ng l√¢u ng√†y, khi·∫øn n·∫°n nh√¢n t·ª± nghi ng·ªù c·∫£m x√∫c c·ªßa m√¨nh, t·ª± ƒë·ªï l·ªói cho b·∫£n th√¢n ngay c·∫£ khi kh√¥ng l√†m g√¨ sai.</p>
            </div>
          </div>
        </div>
        <div class="flex justify-center">
            <img src="/images/image_2.jpg" alt="Ng∆∞·ªùi g·ª° r·ªëi t∆° l√≤ng" class="rounded-2xl shadow-lg max-h-80 object-cover transform hover:scale-105 transition duration-300">
        </div>
      </div>
    </section>

    <section class="bg-white p-6 md:p-8 rounded-3xl shadow-xl card-hover fade-in-up delay-400">
      <h2 class="text-3xl font-bold text-slate-900 mb-8 flex items-center">
        <span class="bg-purple-600 w-2 h-8 mr-3 rounded-full"></span>
        B·∫£ng so s√°nh chi ti·∫øt
      </h2>
      <div class="overflow-hidden rounded-2xl shadow-md border border-slate-200">
        <img src="/images/image_8.jpg" alt="B·∫£ng so s√°nh ph·∫ßn 1" class="w-full h-auto border-b border-slate-100">
        <img src="/images/image_0.jpg" alt="B·∫£ng so s√°nh ph·∫ßn 2" class="w-full h-auto -mt-px">
      </div>
      <p class="text-center text-sm text-slate-500 mt-4 italic">B·∫£ng so s√°nh s·ª± kh√°c bi·ªát gi·ªØa Gaslighting v√† Self-gaslighting.</p>
    </section>

    <section class="grid md:grid-cols-2 gap-8 fade-in-up">
      <div class="bg-white p-6 md:p-8 rounded-3xl shadow-xl card-hover">
        <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center">
          <span class="bg-orange-500 w-2 h-8 mr-3 rounded-full"></span>
          Bi·ªÉu hi·ªán th∆∞·ªùng g·∫∑p
        </h2>
        <img src="/images/image_4.jpg" alt="B√†n tay thao t√∫ng r·ªëi ren" class="w-full h-48 object-cover rounded-2xl mb-6 shadow-sm">
        <ul class="space-y-3 text-slate-700 font-medium">
          <li class="flex items-start"><span class="text-orange-500 mr-2">Is</span> Ph·ªß nh·∫≠n s·ª± th·∫≠t tr∆° tr·∫Ωn ("Tao ch∆∞a bao gi·ªù n√≥i th·∫ø!").</li>
          <li class="flex items-start"><span class="text-orange-500 mr-2">Is</span> B√≥p m√©o th√¥ng tin, k·ªÉ l·∫°i s·ª± vi·ªác theo h∆∞·ªõng c√≥ l·ª£i cho h·ªç.</li>
          <li class="flex items-start"><span class="text-orange-500 mr-2">Is</span> ƒê·ªï l·ªói ng∆∞·ª£c ("T·∫°i em qu√° nh·∫°y c·∫£m th√¥i").</li>
          <li class="flex items-start"><span class="text-orange-500 mr-2">Is</span> D√πng l·ªùi khen gi·∫£ t·∫°o xen l·∫´n ch·ªâ tr√≠ch ƒë·ªÉ g√¢y hoang mang.</li>
          <li class="flex items-start"><span class="text-orange-500 mr-2">Is</span> C√¥ l·∫≠p b·∫°n kh·ªèi b·∫°n b√®, ng∆∞·ªùi th√¢n.</li>
        </ul>
      </div>
      <div class="bg-white p-6 md:p-8 rounded-3xl shadow-xl card-hover">
        <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center">
          <span class="bg-red-600 w-2 h-8 mr-3 rounded-full"></span>
          T√°c ƒë·ªông ti√™u c·ª±c
        </h2>
        <img src="/images/image_3.jpg" alt="ƒêi tr√™n d√¢y gi·ªØa hai t√¢m tr√≠" class="w-full h-48 object-cover rounded-2xl mb-6 shadow-sm">
        <ul class="space-y-3 text-slate-700 font-medium">
          <li class="flex items-start"><span class="text-red-600 mr-2">Is</span> M·∫•t ni·ªÅm tin v√†o b·∫£n th√¢n v√† kh·∫£ nƒÉng ph√°n ƒëo√°n.</li>
          <li class="flex items-start"><span class="text-red-600 mr-2">Is</span> Th∆∞·ªùng xuy√™n lo √¢u, b·∫•t an, c·∫£m th·∫•y m√¨nh "c√≥ v·∫•n ƒë·ªÅ".</li>
          <li class="flex items-start"><span class="text-red-600 mr-2">Is</span> R∆°i v√†o tr·∫°ng th√°i tr·∫ßm c·∫£m, c√¥ ƒë∆°n.</li>
          <li class="flex items-start"><span class="text-red-600 mr-2">Is</span> Kh√≥ khƒÉn trong vi·ªác ƒë∆∞a ra quy·∫øt ƒë·ªãnh.</li>
          <li class="flex items-start"><span class="text-red-600 mr-2">Is</span> Ph·ª• thu·ªôc c·∫£m x√∫c v√†o ng∆∞·ªùi thao t√∫ng.</li>
        </ul>
      </div>
    </section>

    <section class="bg-white p-6 md:p-8 rounded-3xl shadow-xl card-hover fade-in-up">
      <div class="grid md:grid-cols-5 gap-8 items-center">
        <div class="md:col-span-2 flex justify-center">
            <img src="/images/image_5.jpg" alt="N√£o v√† tim thi·ªÅn ƒë·ªãnh" class="rounded-2xl shadow-lg max-h-72 object-cover transform hover:scale-105 transition duration-300">
        </div>
        <div class="md:col-span-3">
          <h2 class="text-3xl font-bold text-slate-900 mb-6 flex items-center">
            <span class="bg-green-500 w-2 h-8 mr-3 rounded-full"></span>
            Ph√≤ng tr√°nh & Ch·ªØa l√†nh
          </h2>
          <div class="space-y-4">
            <div class="flex items-start">
                <div class="flex-shrink-0 w-10 h-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center font-bold mr-4">1</div>
                <p class="text-slate-700 mt-2"><strong>Tin v√†o tr·ª±c gi√°c:</strong> N·∫øu c·∫£m th·∫•y ƒëi·ªÅu g√¨ ƒë√≥ kh√¥ng ·ªïn, r·∫•t c√≥ th·ªÉ n√≥ kh√¥ng ·ªïn th·∫≠t. ƒê·ª´ng ph·ªõt l·ªù c·∫£m x√∫c c·ªßa m√¨nh.</p>
            </div>
            <div class="flex items-start">
                <div class="flex-shrink-0 w-10 h-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center font-bold mr-4">2</div>
                <p class="text-slate-700 mt-2"><strong>Ghi ch√©p l·∫°i:</strong> Vi·∫øt nh·∫≠t k√Ω, l∆∞u tin nh·∫Øn l√†m b·∫±ng ch·ª©ng ƒë·ªÉ ƒë·ªëi chi·∫øu khi b·ªã ph·ªß nh·∫≠n s·ª± th·∫≠t.</p>
            </div>
            <div class="flex items-start">
                <div class="flex-shrink-0 w-10 h-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center font-bold mr-4">3</div>
                <p class="text-slate-700 mt-2"><strong>Thi·∫øt l·∫≠p ranh gi·ªõi:</strong> H·ªçc c√°ch n√≥i "kh√¥ng" v√† gi·ªØ kho·∫£ng c√°ch v·ªõi nh·ªØng ng∆∞·ªùi kh√¥ng t√¥n tr·ªçng b·∫°n.</p>
            </div>
            <div class="flex items-start">
                <div class="flex-shrink-0 w-10 h-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center font-bold mr-4">4</div>
                <p class="text-slate-700 mt-2"><strong>T√¨m ki·∫øm s·ª± h·ªó tr·ª£:</strong> Chia s·∫ª v·ªõi b·∫°n b√® tin c·∫≠y, ng∆∞·ªùi th√¢n ho·∫∑c chuy√™n gia t√¢m l√Ω ƒë·ªÉ c√≥ g√≥c nh√¨n kh√°ch quan.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="ai-chat" class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-200 fade-in-up">
      <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
        <h2 class="text-2xl font-bold flex items-center gap-3">
          ü§ñ Tr·ª£ l√Ω ·∫£o t√¢m l√Ω (AI Beta)
        </h2>
        <p class="text-indigo-100 text-sm mt-2">Chia s·∫ª c√¢u chuy·ªán c·ªßa b·∫°n, AI s·∫Ω l·∫Øng nghe v√† ph√¢n t√≠ch d·ª±a tr√™n ki·∫øn th·ª©c v·ªÅ Gaslighting.</p>
      </div>

      <div class="p-6 bg-slate-50">
        <div id="chatHistory" class="chat-container bg-white border border-slate-200 rounded-2xl p-6 mb-6 shadow-inner space-y-4">
          <div class="ai-msg p-4 text-sm shadow-sm">
            Ch√†o b·∫°n! M√¨nh l√† tr·ª£ l√Ω AI. M√¨nh ·ªü ƒë√¢y ƒë·ªÉ l·∫Øng nghe v√† h·ªó tr·ª£ b·∫°n ph√¢n t√≠ch c√°c t√¨nh hu·ªëng trong m·ªëi quan h·ªá. <br><br>
            B·∫°n ƒëang bƒÉn khoƒÉn ƒëi·ªÅu g√¨? H√£y k·ªÉ cho m√¨nh nghe nh√©. üõ°Ô∏è
          </div>
        </div>

        <div class="relative flex items-end space-x-2">
          <div class="flex-grow relative">
              <textarea id="userPrompt" rows="2" class="w-full p-4 pr-12 bg-white rounded-2xl border border-slate-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none resize-none shadow-sm transition text-slate-700" placeholder="V√≠ d·ª•: Ng∆∞·ªùi y√™u m√¨nh lu√¥n n√≥i m√¨nh nh·ªõ nh·∫ßm m·ªçi th·ª©..."></textarea>
              <div class="absolute right-3 bottom-3 text-slate-400">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9 3h9.0184M5.25 21h13.5c.966 0 1.75-.784 1.75-1.75V6.75c0-.966-.784-1.75-1.75-1.75H5.25c-.966 0-1.75.784-1.75 1.75v12.5c0 .966.784 1.75 1.75 1.75Z" />
                  </svg>
              </div>
          </div>
          <button id="sendMessageBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-2xl font-medium transition shadow-md flex-shrink-0 group">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 transform group-hover:translate-x-1 transition">
              <path d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z" />
            </svg>
          </button>
        </div>
        <p class="text-xs text-center text-slate-500 mt-4">L∆∞u √Ω: AI c√≥ th·ªÉ m·∫Øc l·ªói. Th√¥ng tin ch·ªâ mang t√≠nh tham kh·∫£o, kh√¥ng thay th·∫ø l·ªùi khuy√™n chuy√™n gia.</p>
      </div>
    </section>

    <section class="bg-white p-6 md:p-8 rounded-3xl shadow-xl card-hover fade-in-up border-t-4 border-pink-500">
      <div class="grid md:grid-cols-5 gap-8 items-center">
        <div class="md:col-span-3">
            <h2 class="text-3xl font-bold text-slate-900 mb-4 flex items-center">
                <span class="bg-pink-500 w-2 h-8 mr-3 rounded-full"></span>
                G√≥c T√¢m S·ª± & Chia S·∫ª
            </h2>
            <p class="text-slate-700 mb-6">B·∫°n c√≥ c√¢u chuy·ªán c·ªßa ri√™ng m√¨nh mu·ªën chia s·∫ª? ƒê·ª´ng ng·∫ßn ng·∫°i g·ª≠i cho ch√∫ng t√¥i. C√¢u chuy·ªán c·ªßa b·∫°n c√≥ th·ªÉ l√† ngu·ªìn ƒë·ªông vi√™n l·ªõn lao cho ng∆∞·ªùi kh√°c.</p>
            
            <form class="space-y-4" action="mailto:admin@example.com" method="post" enctype="text/plain">
                <div>
                    <label for="name" class="block text-sm font-medium text-slate-700 mb-1">T√™n c·ªßa b·∫°n (ho·∫∑c bi·ªát danh)</label>
                    <input type="text" id="name" name="name" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-300 focus:border-pink-500 focus:ring-2 focus:ring-pink-200 outline-none transition" placeholder="Ng∆∞·ªùi ·∫©n danh">
                </div>
                <div>
                    <label for="story" class="block text-sm font-medium text-slate-700 mb-1">C√¢u chuy·ªán c·ªßa b·∫°n</label>
                    <textarea id="story" name="story" rows="5" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-300 focus:border-pink-500 focus:ring-2 focus:ring-pink-200 outline-none resize-none transition" placeholder="H√£y chia s·∫ª nh·ªØng g√¨ b·∫°n ƒë√£ tr·∫£i qua..."></textarea>
                </div>
                <button type="submit" class="bg-pink-600 hover:bg-pink-700 text-white px-6 py-3 rounded-xl font-bold transition shadow-md flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                    </svg>
                    G·ª≠i c√¢u chuy·ªán
                </button>
                <p class="text-xs text-slate-500 mt-2 italic">*N√∫t n√†y s·∫Ω m·ªü ·ª©ng d·ª•ng email c·ªßa b·∫°n ƒë·ªÉ g·ª≠i th∆∞.</p>
            </form>
        </div>
        <div class="md:col-span-2 flex justify-center order-first md:order-last">
            <img src="/images/image_7.jpg" alt="C√¢n b·∫±ng c·∫£m x√∫c" class="rounded-2xl shadow-lg max-h-72 object-cover transform hover:scale-105 transition duration-300">
        </div>
      </div>
    </section>

    <footer class="text-center text-sm text-slate-500 py-10 border-t border-slate-200">
      <p>&copy; 2025 D·ª± √°n Nh·∫≠n Di·ªán Gaslighting. V√¨ m·ªôt c·ªông ƒë·ªìng th·∫•u c·∫£m.</p>
    </footer>
  </main>

  <script>
    const chatHistoryDiv = document.getElementById('chatHistory');
    const userPromptInput = document.getElementById('userPrompt');
    const sendBtn = document.getElementById('sendMessageBtn');

    // L·ªãch s·ª≠ h·ªôi tho·∫°i m·∫´u ƒë·ªÉ AI hi·ªÉu ng·ªØ c·∫£nh
    let conversationHistory = [
      {
        role: "user",
        parts: [{ text: "B·∫°n l√† m·ªôt chuy√™n gia t√¢m l√Ω h·ªçc ƒë∆∞·ªùng th√¢n thi·ªán, gi√†u l√≤ng tr·∫Øc ·∫©n. Nhi·ªám v·ª• c·ªßa b·∫°n l√† l·∫Øng nghe ng∆∞·ªùi d√πng chia s·∫ª v·ªÅ c√°c m·ªëi quan h·ªá c·ªßa h·ªç. D·ª±a tr√™n ki·∫øn th·ª©c v·ªÅ Gaslighting v√† Self-gaslighting, h√£y ph√¢n t√≠ch nh·∫π nh√†ng xem h·ªç c√≥ ƒëang g·∫∑p ph·∫£i c√°c d·∫•u hi·ªáu n√†y kh√¥ng. H√£y ƒë∆∞a ra nh·ªØng l·ªùi khuy√™n thi·∫øt th·ª±c, ng·∫Øn g·ªçn v√† mang t√≠nh n√¢ng ƒë·ª°. S·ª≠ d·ª•ng emoji ƒë·ªÉ t·∫°o c·∫£m gi√°c g·∫ßn g≈©i. N·∫øu nh·∫≠n th·∫•y t√¨nh hu·ªëng nghi√™m tr·ªçng ho·∫∑c nguy hi·ªÉm, h√£y khuy√™n h·ªç t√¨m ki·∫øm s·ª± tr·ª£ gi√∫p t·ª´ ng∆∞·ªùi l·ªõn tin c·∫≠y ho·∫∑c chuy√™n gia t√¢m l√Ω." }]
      },
      {
        role: "model",
        parts: [{ text: "Ch√†o b·∫°n, m√¨nh l√† tr·ª£ l√Ω AI t√¢m l√Ω. M√¨nh ·ªü ƒë√¢y ƒë·ªÉ l·∫Øng nghe v√† ƒë·ªìng h√†nh c√πng b·∫°n. B·∫°n c·ª© tho·∫£i m√°i chia s·∫ª nh√©, kh√¥ng gian n√†y l√† c·ªßa b·∫°n. üõ°Ô∏èüíñ" }]
      }
    ];

    // H√†m th√™m tin nh·∫Øn v√†o giao di·ªán
    function appendMessage(role, text, isError = false) {
      const div = document.createElement('div');
      div.className = isError 
        ? 'error-msg' 
        : (role === 'user' ? 'user-msg p-4 text-sm shadow-sm mb-4' : 'ai-msg p-4 text-sm shadow-sm mb-4');
      
      // S·ª≠ d·ª•ng marked ƒë·ªÉ render Markdown cho tin nh·∫Øn c·ªßa AI, thay th·∫ø xu·ªëng d√≤ng cho user
      div.innerHTML = (role === 'model' && !isError) ? marked.parse(text) : text.replace(/\n/g, '<br>');
      
      chatHistoryDiv.appendChild(div);
      chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight; // T·ª± ƒë·ªông cu·ªôn xu·ªëng cu·ªëi
    }

    // H√†m hi·ªÉn th·ªã hi·ªáu ·ª©ng ƒëang nh·∫≠p
    function showLoading() {
      const div = document.createElement('div');
      div.id = 'loadingIndicator';
      div.className = 'ai-msg p-4 text-sm shadow-sm mb-4 typing-indicator flex items-center';
      div.innerHTML = 'AI ƒëang suy nghƒ© <span></span><span></span><span></span>';
      chatHistoryDiv.appendChild(div);
      chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
    }

    // H√†m x√≥a hi·ªáu ·ª©ng ƒëang nh·∫≠p
    function removeLoading() {
      const loading = document.getElementById('loadingIndicator');
      if(loading) loading.remove();
    }

    // X·ª≠ l√Ω s·ª± ki·ªán g·ª≠i tin nh·∫Øn
    sendBtn.addEventListener('click', async () => {
      const userText = userPromptInput.value.trim();
      if (!userText) return;

      // 1. Hi·ªÉn th·ªã tin nh·∫Øn c·ªßa ng∆∞·ªùi d√πng
      appendMessage('user', userText);
      userPromptInput.value = '';
      userPromptInput.style.height = 'auto'; // Reset chi·ªÅu cao textarea
      showLoading();

      try {
        // 2. G·ª≠i y√™u c·∫ßu l√™n Server Vercel (api/chat.js)
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            history: conversationHistory, // G·ª≠i k√®m l·ªãch s·ª≠ ƒë·ªÉ AI nh·ªõ ng·ªØ c·∫£nh
            message: userText 
          })
        });

        const data = await response.json();
        removeLoading();

        if (!response.ok || data.error) {
          // Hi·ªÉn th·ªã l·ªói n·∫øu server tr·∫£ v·ªÅ l·ªói
          appendMessage('model', `L·ªói: ${data.error}`, true);
        } else {
          // Hi·ªÉn th·ªã ph·∫£n h·ªìi t·ª´ AI
          appendMessage('model', data.reply);
          
          // C·∫≠p nh·∫≠t l·ªãch s·ª≠ h·ªôi tho·∫°i
          conversationHistory.push({ role: "user", parts: [{ text: userText }] });
          conversationHistory.push({ role: "model", parts: [{ text: data.reply }] });
        }
      } catch (error) {
        // X·ª≠ l√Ω l·ªói m·∫°ng
        removeLoading();
        appendMessage('model', `L·ªói k·∫øt n·ªëi. Vui l√≤ng ki·ªÉm tra m·∫°ng c·ªßa b·∫°n.`, true);
      }
    });

    // Cho ph√©p ·∫•n Enter ƒë·ªÉ g·ª≠i (Shift+Enter ƒë·ªÉ xu·ªëng d√≤ng)
    userPromptInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendBtn.click();
      }
    });

    // T·ª± ƒë·ªông thay ƒë·ªïi chi·ªÅu cao textarea khi nh·∫≠p
    userPromptInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
  </script>
</body>
</html>
